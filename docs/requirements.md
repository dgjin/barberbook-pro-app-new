# BarberBook Pro 系统需求说明书 (PRD)

## 1. 项目概述
BarberBook Pro 是一款专为高端理发店打造的预约、排队与运营管理系统。系统旨在消除排队焦虑，提升理发师工作效率，并为顾客提供智能化的服务体验。

## 2. 用户角色定义
| 角色 | 核心职责 | 关注点 |
| :--- | :--- | :--- |
| **顾客** | 浏览服务、远程预约、在线签到、查看排位 | 便捷性、透明度 |
| **理发师** | 接收预约通知、管理个人队列、切换叫号状态 | 流程丝滑、减少干扰 |
| **管理员** | 配置门面信息、增删服务项目、人员排班、查看数据统计、管理理发师状态 | 统计准确、系统稳定性 |

## 3. 核心功能需求

### 3.1 预约与排队 (Booking & Queue)
- **多端预约**：顾客可通过移动端实时查看空闲时段并在线预约。
- **自动叫号逻辑**：当理发师在工作台点击"开始下个服务"时，系统自动将下一位顾客的状态变更为"已签到 (Checked In)"。
- **单号系统**：每位顾客拥有独立单号，支持理发券抵扣逻辑（自动抵扣余额）。
- **休息状态过滤**：状态为"休息"的理发师不出现在可预约列表和监控大屏中。

### 3.2 智能叫号大屏 (Web Monitor)
- **实时同步**：通过 Supabase Realtime 监听预约状态变化，秒级响应。
- **语音播报 (TTS)**：集成科大讯飞星火超拟音引擎（聆小玥），自动播报叫号信息。
- **混合驱动**：支持"WebSocket 实时"+"5秒周期轮询"双驱动模式，确保内网波动时不丢单。
- **状态看板**：可视化展示各发型师的"正在服务"与"等待序列"。
- **休息状态过滤**：休息状态的理发师不显示在监控大屏上。

### 3.3 理发师工作台 (Workbench)
- **一键叫号**：集成状态机转换（进行中 -> 已完成 -> 下一位移动至进行中）。
- **实时提醒**：通过 WebSocket 实时接收新预约信息。
- **重新播报**：支持点击按钮重新语音播报当前服务客户信息（单次播报）。
- **待服务队列**：当理发师忙碌时，新签到客户自动进入待服务队列。

### 3.4 语音播报系统 (Voice Announcement)
- **自动播报**：客户签到且理发师空闲时，自动播报叫号。
- **完成播报**：理发师完成服务后，自动播报呼叫下一位客户。
- **重复播报机制**：默认播报3次，每次间隔60秒。
- **手动重播**：理发师工作台提供"重新语音播报"按钮，点击播报一次。
- **防重复机制**：已播报3次的客户不再自动播报。

### 3.5 系统管理 (Admin)
- **服务项目配置**：支持对理发、洗头、SPA 等不同套餐的图标、价格、时长进行管理。
- **营业时段控制**：配置开门/打烊时间，过期时段自动禁止预约。
- **人员管理**：
  - 理发师信息管理（昵称、真实姓名、电话、职级、专长等）
  - 快速搜索：支持通过昵称、真实姓名、电话号码搜索理发师和客户
  - 状态切换：提供"上班"/"休息"快速按钮，实时切换理发师状态
  - 客户档案管理（昵称、真实姓名、电话、理发券数量等）
- **数据看板**：
  - 多维度统计：支持周、月、季度、年度四个维度查看数据
  - 理发券核销统计：各理发师的理发券使用数量
  - 预约次数统计：各维度的总预约单数
  - 券使用占比：理发券使用占总预约的比例
  - 理发师业绩排行：按理发券核销数排序
- **排班监控**：可视化展示理发师的排班情况和可预约时段，已过期时段显示为不可预约。

## 4. 非功能性需求
- **高性能**：大屏组件需支持长时间挂机（24小时+）不卡顿。
- **鲁棒性**：TTS 服务需具备网络异常自动回退到浏览器原生语音的能力。
- **视觉体验**：采用深色拟态或极简 iOS 风格，提升品牌高级感。

## 5. 更新日志

### v1.1.0 (2024-02-22)
- 新增理发师"上班"/"休息"状态管理功能
- 新增数据看板多维度统计（周、月、季度、年度）
- 新增语音播报重复机制（默认3次，间隔60秒）
- 新增理发师工作台重新播报功能
- 优化人员管理搜索功能（支持昵称、真实姓名、电话搜索）
- 优化排班监控显示（过期时段标记为不可预约）
